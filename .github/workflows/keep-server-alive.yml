name: Keep CloudType Server Alive

on:
  schedule:
    # Îß§Ïùº Ïò§Ï†Ñ 8Ïãú 50Î∂Ñ (KST) - UTCÎ°úÎäî Ï†ÑÎÇ† 23:50
    # CloudType Î¨¥Î£å Ìã∞Ïñ¥Îäî Îß§Ïùº Ïò§Ï†Ñ 9ÏãúÏóê ÏùºÏãúÏ†ïÏßÄÎêòÎØÄÎ°ú, Í∑∏ Ï†ÑÏóê Ìïë
    - cron: "50 23 * * *" # '*/30 * * * *' - 30Î∂ÑÎßàÎã§
  workflow_dispatch: # ÏàòÎèô Ïã§Ìñâ Í∞ÄÎä•

jobs:
  wake-server:
    runs-on: ubuntu-latest

    steps:
      - name: Ping CloudType Server
        run: |
          echo "üîî Pinging server at $(date)"

          # Health check ÏóîÎìúÌè¨Ïù∏Ìä∏ Ìò∏Ï∂ú
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET ${{ secrets.SERVER_URL }}/health \
            --max-time 30)

          if [ $response -eq 200 ]; then
            echo "‚úÖ Server is alive! (HTTP $response)"
          else
            echo "‚ö†Ô∏è  Server responded with HTTP $response"
            # Ïã§Ìå®Ìï¥ÎèÑ ÏõåÌÅ¨ÌîåÎ°úÏö∞Îäî Í≥ÑÏÜç ÏßÑÌñâ (ÏÑúÎ≤ÑÍ∞Ä ÏùºÏãúÏ†ïÏßÄ ÏÉÅÌÉúÏùº Ïàò ÏûàÏùå)
          fi

      - name: Wait for server to wake up
        run: |
          echo "‚è≥ Waiting for server to fully wake up..."
          sleep 10

      - name: Verify server is running
        run: |
          echo "üîç Verifying server status..."

          response=$(curl -s -X GET ${{ secrets.SERVER_URL }}/health)
          echo "üìä Server response: $response"

          status=$(echo $response | jq -r '.status' 2>/dev/null || echo "unknown")

          if [ "$status" = "ok" ]; then
            echo "‚úÖ Server is confirmed running!"
          else
            echo "‚ö†Ô∏è  Server status: $status"
          fi
