# Chapter 1. 제품 요구사항 문서 (PRD)

## 1.1 개요

1. **위젯 이름:** 이미지 자르기(Image Cropper)
2. **목적:** 대시보드 안에서 업로드·붙여넣기한 이미지를 빠르게 잘라 외부 툴 없이 바로 활용할 수 있도록 지원합니다.
3. **주요 사용자:** 작업 카드나 노트에 시각 자료를 자주 붙여넣는 디자이너, 마케터, 운영 담당자.

## 1.2 목표

1. 사용자가 이미지를 드래그 앤 드롭/붙여넣기해 사전 지정 비율 또는 자유 비율로 자른 뒤 PNG·JPEG·WebP로 내보낼 수 있도록 한다.
2. 최근 사용한 비율과 최근 내보내기를 저장해 반복 작업 시간을 줄인다.
3. 타 위젯과 동일한 인터랙션 패턴(맡틴 스타일, 키보드 포커스, 라이트/다크 모드)을 유지한다.

## 1.3 비범위(Not in Scope)

1. 필터, 멀티 레이어, 주석 등 고급 편집 기능.
2. 다중 파일 일괄 처리나 자동 배경 제거.

## 1.4 성공 지표

1. 위젯을 연 사용자 중 ≥80%가 2분 이내에 내보내기를 완료.
2. 세션 1,000건당 자르기/내보내기 실패율 ≤2%.
3. 출시 첫 달 내 주간 활성 사용자 중 ≥30%가 최소 1회 위젯 사용.

## 1.5 사용자 스토리

1. **디자이너로서** 스크린샷을 붙여넣고 16:9로 빠르게 잘라 슬라이드에 삽입하고 싶다.
2. **마케터로서** SNS 업로드 전에 브랜드 비율(1:1, 4:5)을 강제하고 싶다.
3. **매니저로서** 저장 없이 잘라낸 이미지를 체크리스트 항목에 바로 첨부하고 싶다.

## 1.6 기능 요구사항

1. 입력 경로: 드래그 앤 드롭, 파일 선택기(≤20MB), 클립보드 붙여넣기.
2. 자르기 도구: 자유 비율, 사용자 정의 비율, 프리셋(1:1, 4:3, 16:9, 9:16, 4:5).
3. 자르기 프레임 내 확대/이동, 방향키로 1px 미세 조정.
4. 출력 제어: 형식 선택기(PNG 기본), JPEG/WebP 품질 슬라이더, 투명 배경 토글(입력에 알파가 있는 경우).
5. 내보내기 옵션: 파일 다운로드, 클립보드 복사, 데이터 URL 복사, 다른 위젯으로 삽입(API 제공 시).
6. 히스토리: 최근 5개 내보내기 썸네일 + “다시 삽입” 목록.
7. 접근성: 키보드로 조작 가능한 핸들, 포커스 표시, 설명형 ARIA 레이블.

## 1.7 기술 고려사항

1. 기존 Mantine 모달/위젯 셸 활용, MIT 라이선스 React 캔버스/크롭 라이브러리(예: react-easy-crop) 재사용.
2. 임시 이미지 데이터는 컴포넌트 상태에 저장, 마지막 프리셋·포맷은 `useUserSettingsStore`에 영속화.
3. 클립보드 동작은 보안 컨텍스트·권한 요구, 실패 시 다운로드로 우아하게 대체.
4. 대용량 이미지는 클라이언트 측에서 최대 변 4096px로 다운스케일해 메모리 스파이크 방지.
5. 분석용 잘라내기 세션 메타데이터에 대한 TypeScript 타입 제공.

## 1.8 리스크 및 대응

1. **대용량 파일 성능:** 다운스케일 및 인코딩 워커 오프로딩 적용.
2. **클립보드 제한:** 지원 여부 감지 후 가이드 노출, 항상 다운로드 옵션 제공.
3. **라이선스:** 선택 라이브러리가 레포 라이선스와 호환되는지 검증.

---

# Chapter 3. Phase 2 — UX 및 비주얼 디자인 체크리스트

- [ ] 3.1 (가져오기 → 자르기 → 내보내기) 저충실도 플로우를 제작해 PM과 리뷰한다.
- [ ] 3.2 라이트/다크 테마에서의 고충실도 시안을 제작하고 모든 컨트롤 및 에러 상태를 포함한다.
- [ ] 3.3 확대/이동/핸들 모션과 키보드 인터랙션을 문서화한다.
- [ ] 3.4 최소·최대 위젯 크기, 컨트롤 접힘 기준 등 반응형 동작을 정의한다.
- [ ] 3.5 구현을 위한 토큰화된 명세(간격, 색상 등)를 전달한다.

---

# Chapter 4. Phase 3 — 엔지니어링 구현 체크리스트

- [ ] 4.1 `ImageCropWidget` 컴포넌트와 상태/영속화를 위한 Zustand 슬라이스를 스캐폴딩한다.
- [ ] 4.2 선정한 크로퍼 라이브러리를 Mantine 레이아웃·테마와 통합한다.
- [ ] 4.3 드롭존, 파일 선택기, 클립보드 입력 흐름을 용량 검증과 함께 구현한다.
- [ ] 4.4 캔버스 렌더링, 포맷 선택, 품질 슬라이더를 포함한 내보내기 파이프라인을 구축한다.
- [ ] 4.5 썸네일과 재사용 액션이 포함된 최근 내보내기 리스트를 연결한다.
- [ ] 4.6 열기/가져오기/자르기/내보내기 이벤트에 대한 분석 로깅을 추가한다.
- [ ] 4.7 포커스 트랩, ARIA 레이블, 키보드 미세 조정 등 접근성을 구현한다.

---

# Chapter 5. Phase 4 — QA, 출시 및 반복 체크리스트

- [ ] 5.1 스토어 로직, 클립보드 폴백, 비율 계산을 검증하는 단위/통합 테스트를 작성한다.
- [ ] 5.2 Chrome·Edge·Safari에서 드래그 앤 드롭과 클립보드를 포함한 수동 크로스 브라우저 QA를 진행한다.
- [ ] 5.3 4,000px 이상의 대용량 이미지로 성능을 점검하고 메모리 사용량을 측정한다.
- [ ] 5.4 기능 플래그와 롤아웃 계획(내부 베타 → 25% → 100%)을 준비한다.
- [ ] 5.5 사용자 교육용 스니펫/툴팁을 제작하고 도움말 문서를 업데이트한다.
- [ ] 5.6 출시 후 피드백을 수집하고 v1.1 개선 백로그를 계획한다.
